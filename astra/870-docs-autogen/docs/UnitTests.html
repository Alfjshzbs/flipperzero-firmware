<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unit tests &mdash; Flipper Zero Firmware  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Universal Remotes" href="UniversalRemotes.html" />
    <link rel="prev" title="Roadmap" href="RoadMap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Flipper Zero Firmware
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doxygen/html/index.html">Auto-generated</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_formats/index.html">Flipper Zero File Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="AppManifests.html">Flipper Application Manifests (.fam)</a></li>
<li class="toctree-l1"><a class="reference internal" href="AppsOnSDCard.html">FAP (Flipper Application Package)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fbt.html">Flipper Build Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="FuriHalDebugging.html">Furi HAL Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="HardwareTargets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="KeyCombo.html">Key Combos</a></li>
<li class="toctree-l1"><a class="reference internal" href="KeyCombo.html#alternative-ways-to-recover-your-device">Alternative ways to recover your device</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFRFIDRaw.html">Reading RAW RFID data</a></li>
<li class="toctree-l1"><a class="reference internal" href="OTA.html">Executing code from RAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="RoadMap.html">Roadmap</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Unit tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-unit-tests">Running unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-unit-tests">Adding unit tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general">General</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#entry-point">Entry point</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-assets">Test assets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#application-specific">Application-specific</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#infrared">Infrared</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="UniversalRemotes.html">Universal Remotes</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeneratingDocs.html">Generating documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Flipper Zero Firmware</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Unit tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/UnitTests.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unit-tests">
<h1>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading"></a></h1>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this heading"></a></h2>
<p>Unit tests are special pieces of code that apply known inputs to the feature code and check the results to see if they are correct.
They are crucial for writing robust, bug-free code.</p>
<p>Flipper Zero firmware includes a separate application called <a class="reference internal" href="#/applications/debug/unit_tests"><span class="xref myst">unit_tests</span></a>.
It is run directly on Flipper devices in order to employ their hardware features and rule out any platform-related differences.</p>
<p>When contributing code to the Flipper Zero firmware, it is highly desirable to supply unit tests along with the proposed features.
Running existing unit tests is useful to ensure that the new code doesn’t introduce any regressions.</p>
</section>
<section id="running-unit-tests">
<h2>Running unit tests<a class="headerlink" href="#running-unit-tests" title="Permalink to this heading"></a></h2>
<p>To run the unit tests, follow these steps:</p>
<ol class="arabic simple">
<li><p>Compile the firmware with the tests enabled: <code class="docutils literal notranslate"><span class="pre">./fbt</span> <span class="pre">FIRMWARE_APP_SET=unit_tests</span></code>.</p></li>
<li><p>Flash the firmware using your preferred method.</p></li>
<li><p>Copy the <a class="reference internal" href="#/assets/unit_tests"><span class="xref myst">assets/unit_tests</span></a> folder to the root of your Flipper Zero’s SD card.</p></li>
<li><p>Launch the CLI session and run the <code class="docutils literal notranslate"><span class="pre">unit_tests</span></code> command.</p></li>
</ol>
<p><strong>NOTE:</strong> To run a particular test (and skip all others), specify its name as the command argument.
See <a class="reference internal" href="#/applications/debug/unit_tests/test_index.c"><span class="xref myst">test_index.c</span></a> for the complete list of test names.</p>
</section>
<section id="adding-unit-tests">
<h2>Adding unit tests<a class="headerlink" href="#adding-unit-tests" title="Permalink to this heading"></a></h2>
<section id="general">
<h3>General<a class="headerlink" href="#general" title="Permalink to this heading"></a></h3>
<section id="entry-point">
<h4>Entry point<a class="headerlink" href="#entry-point" title="Permalink to this heading"></a></h4>
<p>The common entry point for all tests is the <a class="reference internal" href="#/applications/debug/unit_tests"><span class="xref myst">unit_tests</span></a> application. Test-specific code is placed into an arbitrarily named subdirectory and is then called from the <a class="reference internal" href="#/applications/debug/unit_tests/test_index.c"><span class="xref myst">test_index.c</span></a> source file.</p>
</section>
<section id="test-assets">
<h4>Test assets<a class="headerlink" href="#test-assets" title="Permalink to this heading"></a></h4>
<p>Some unit tests require external data in order to function. These files (commonly called assets) reside in the <a class="reference internal" href="#/assets/unit_tests"><span class="xref myst">assets/unit_tests</span></a> directory in their respective subdirectories. Asset files can be of any type (plain text, FlipperFormat (FFF), binary, etc.).</p>
</section>
</section>
<section id="application-specific">
<h3>Application-specific<a class="headerlink" href="#application-specific" title="Permalink to this heading"></a></h3>
<section id="infrared">
<h4>Infrared<a class="headerlink" href="#infrared" title="Permalink to this heading"></a></h4>
<p>Each infrared protocol has a corresponding set of unit tests, so it makes sense to implement one when adding support for a new protocol.
To add unit tests for your protocol, follow these steps:</p>
<ol class="arabic simple">
<li><p>Create a file named <code class="docutils literal notranslate"><span class="pre">test_&lt;your_protocol_name&gt;.irtest</span></code> in the <a class="reference internal" href="#/assets/unit_tests/infrared"><span class="xref myst">assets</span></a> directory.</p></li>
<li><p>Fill it with the test data (more on it below).</p></li>
<li><p>Add the test code to <a class="reference internal" href="#/applications/debug/unit_tests/infrared/infrared_test.c"><span class="xref myst">infrared_test.c</span></a>.</p></li>
<li><p>Update the <a class="reference internal" href="#/assets/unit_tests/infrared"><span class="xref myst">assets</span></a> on your Flipper Zero and run the tests to see if they pass.</p></li>
</ol>
<section id="test-data-format">
<h5>Test data format<a class="headerlink" href="#test-data-format" title="Permalink to this heading"></a></h5>
<p>Each unit test has three sections:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">decoder</span></code> - takes in a raw signal and outputs decoded messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoder</span></code> - takes in decoded messages and outputs a raw signal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoder_decoder</span></code> - takes in decoded messages, turns them into a raw signal, and then decodes again.</p></li>
</ol>
<p>Infrared test asset files have an <code class="docutils literal notranslate"><span class="pre">.irtest</span></code> extension and are regular <code class="docutils literal notranslate"><span class="pre">.ir</span></code> files with a few additions.
Decoder input data has signal names <code class="docutils literal notranslate"><span class="pre">decoder_input_N</span></code>, where N is a test sequence number. Expected data goes under the name <code class="docutils literal notranslate"><span class="pre">decoder_expected_N</span></code>. When testing the encoder, these two are switched.</p>
<p>Decoded data is represented in arrays (since a single raw signal may be decoded into several messages). If there is only one signal, then it has to be an array of size 1. Use the existing files as syntax examples.</p>
</section>
<section id="getting-raw-signals">
<h5>Getting raw signals<a class="headerlink" href="#getting-raw-signals" title="Permalink to this heading"></a></h5>
<p>Recording raw IR signals are possible using the Flipper Zero. Launch the CLI session, run <code class="docutils literal notranslate"><span class="pre">ir</span> <span class="pre">rx</span> <span class="pre">raw</span></code>, then point the remote towards Flipper’s receiver and send the signals. The raw signal data will be printed to the console in a convenient format.</p>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="RoadMap.html" class="btn btn-neutral float-left" title="Roadmap" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="UniversalRemotes.html" class="btn btn-neutral float-right" title="Universal Remotes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Flipper Devices.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: astra/870-docs-autogen
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="UnitTests.html">astra/870-docs-autogen</a></dd>
      <dd><a href="../../docs-branches-test/index.html">astra/docs-branches-test</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>